<!DOCTYPE html>
<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
   
<meta charset="UTF-8" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />


<title>Cakephp 2.x Saving and validating a HABTM relation example - Pablo Leano Martinet</title>

<link rel="stylesheet" href="http://www.pabloleanomartinet.com/wp-content/themes/diarjo-lite/style.css" media="screen" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.2, user-scalable=yes" />

<!--[if IE 8]>
    <script src="http://www.pabloleanomartinet.com/wp-content/themes/diarjo-lite/scripts/html5.js" type="text/javascript"></script>
    <script src="http://www.pabloleanomartinet.com/wp-content/themes/diarjo-lite/scripts/selectivizr-min.js" type="text/javascript"></script>
<![endif]-->


<!-- This site is optimized with the Yoast WordPress SEO plugin v1.7.1 - https://yoast.com/wordpress/plugins/seo/ -->
<meta name="description" content="A basic example of saving a HABTM relationship in cakephp 2.x, while also validating (server-side) the number of items saved"/>
<link rel="canonical" href="http://www.pabloleanomartinet.com/cakephp-2-x-saving-validating-habtm-relation-example/" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Cakephp 2.x Saving and validating a HABTM relation example - Pablo Leano Martinet" />
<meta property="og:description" content="A basic example of saving a HABTM relationship in cakephp 2.x, while also validating (server-side) the number of items saved" />
<meta property="og:url" content="http://www.pabloleanomartinet.com/cakephp-2-x-saving-validating-habtm-relation-example/" />
<meta property="og:site_name" content="Pablo Leano Martinet" />
<meta property="article:tag" content="cakephp 2.x" />
<meta property="article:tag" content="habtm" />
<meta property="article:tag" content="save" />
<meta property="article:tag" content="validation" />
<meta property="article:section" content="Posts" />
<meta property="article:published_time" content="2014-01-24T12:35:06+00:00" />
<meta property="article:modified_time" content="2014-12-13T13:52:20+00:00" />
<meta property="og:updated_time" content="2014-12-13T13:52:20+00:00" />
<meta property="og:image" content="http://www.pabloleanomartinet.com/wp-content/uploads/2012/10/model.png" />
<meta property="og:image" content="http://www.pabloleanomartinet.com/wp-content/uploads/2012/10/screen-1024x421.png" />
<!-- / Yoast WordPress SEO plugin. -->

<link rel="alternate" type="application/rss+xml" title="Pablo Leano Martinet &raquo; Feed" href="http://www.pabloleanomartinet.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Pablo Leano Martinet &raquo; Comments Feed" href="http://www.pabloleanomartinet.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Pablo Leano Martinet &raquo; Cakephp 2.x Saving and validating a HABTM relation example Comments Feed" href="http://www.pabloleanomartinet.com/cakephp-2-x-saving-validating-habtm-relation-example/feed/" />
<link rel='stylesheet' id='bootstrap.min-css'  href='http://www.pabloleanomartinet.com/wp-content/themes/diarjo-lite/css/bootstrap.min.css?ver=4.0.1' type='text/css' media='all' />
<link rel='stylesheet' id='bootstrap.theme.min-css'  href='http://www.pabloleanomartinet.com/wp-content/themes/diarjo-lite/css/bootstrap.theme.min.css?ver=4.0.1' type='text/css' media='all' />
<link rel='stylesheet' id='font-awesome.min-css'  href='http://www.pabloleanomartinet.com/wp-content/themes/diarjo-lite/css/font-awesome.min.css?ver=4.0.1' type='text/css' media='all' />
<link rel='stylesheet' id='prettyPhoto-css'  href='http://www.pabloleanomartinet.com/wp-content/themes/diarjo-lite/css/prettyPhoto.css?ver=4.0.1' type='text/css' media='all' />
<link rel='stylesheet' id='template-css'  href='http://www.pabloleanomartinet.com/wp-content/themes/diarjo-lite/css/template.css?ver=4.0.1' type='text/css' media='all' />
<link rel='stylesheet' id='google-fonts-css'  href='//fonts.googleapis.com/css?family=Raleway%3A900%7CFjalla+One%7CRoboto+Slab%3A400%2C300%2C100%2C700&#038;ver=4.0.1' type='text/css' media='all' />
<link rel='stylesheet' id='A2A_SHARE_SAVE-css'  href='http://www.pabloleanomartinet.com/wp-content/plugins/add-to-any/addtoany.min.css?ver=1.9' type='text/css' media='all' />
<script type='text/javascript' src='http://www.pabloleanomartinet.com/wp-includes/js/jquery/jquery.js?ver=1.11.1'></script>
<script type='text/javascript' src='http://www.pabloleanomartinet.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.pabloleanomartinet.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.pabloleanomartinet.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.0.1" />
<link rel='shortlink' href='http://www.pabloleanomartinet.com/?p=12' />

<script type="text/javascript"><!--
var a2a_config=a2a_config||{},wpa2a={done:false,html_done:false,script_ready:false,script_load:function(){var a=document.createElement('script'),s=document.getElementsByTagName('script')[0];a.type='text/javascript';a.async=true;a.src='http://static.addtoany.com/menu/page.js';s.parentNode.insertBefore(a,s);wpa2a.script_load=function(){};},script_onready:function(){if(a2a.type=='page'){wpa2a.script_ready=true;if(wpa2a.html_done)wpa2a.init();}},init:function(){for(var i=0,el,target,targets=wpa2a.targets,length=targets.length;i<length;i++){el=document.getElementById('wpa2a_'+(i+1));target=targets[i];a2a_config.linkname=target.title;a2a_config.linkurl=target.url;if(el){a2a.init('page',{target:el});el.id='';}wpa2a.done=true;}wpa2a.targets=[];}};a2a_config.tracking_callback=['ready',wpa2a.script_onready];
//--></script>
<style type="text/css"><br />
<b>Notice</b>:  Undefined variable: logostyle in <b>/var/www/pabloleanomartinet.com/prod/wp-content/themes/diarjo-lite/core/functions/style.php</b> on line <b>16</b><br />
#header, #footer, #sidebar .post-article, #back-to-top i, nav#mainmenu ul ul, #wp-calendar { background-color: #2D3032; } #sidebar h3.title, #sidebar a, #sidebar p, #sidebar li, #sidebar address,
#sidebar dd, #sidebar blockquote, #sidebar td, #sidebar th, #sidebar label, #sidebar .textwidget, #footer h3.title, #footer a, #footer p, #footer li, #footer address,
#footer dd, #footer blockquote, #footer td, #footer th, #footer label, #footer .textwidget, nav#mainmenu ul li a, #back-to-top i, #wp-calendar caption, #wp-calendar td a, #footer h4.title, #logo a, nav#widgetmenu li a { color: #ffffff; } nav#mainmenu ul ul li:last-of-type a, #searchform input[type=submit], .contact-form input[type=submit], #commentform input[type=submit], #sidebar li, #footer li, #footer .widgets, ul.widget-category, ul.widget-category li a, ul.contact-info li, .bottom_widget ul.contact-info li, .tagcloud a, .socials a, #back-to-top i, nav#mainmenu ul li a, #sidebar ul.children, #sidebar ul.sub-menu, #wp-calendar th, #wp-calendar td, nav#widgetmenu ul, nav#widgetmenu li a, nav#widgetmenu li:last-of-type a, nav#widgetmenu li:last-of-type a:hover, #sidebar li, #footer li, #sidebar ul.children, #sidebar ul.children, #footer ul.sub-menu, #sidebar ul.sub-menu { border-color: #444649; } ::-moz-selection { background-color: #48c9b0; } ::selection { background-color: #48c9b0; } .skills .views, .filter, #searchform input[type=submit], .contact-form input[type=submit], #commentform input[type=submit]{ background-color: #48c9b0; } .skills .views, .filter, #searchform input[type=submit], .contact-form input[type=submit], #commentform input[type=submit] { border-color: #48c9b0; } #subheader, nav#mainmenu ul li a:hover,nav#mainmenu li:hover > a, nav#mainmenu ul li.current-menu-item > a, nav#mainmenu ul li.current_page_item > a, nav#mainmenu ul li.current-menu-parent > a, nav#mainmenu ul li.current_page_ancestor > a, nav#mainmenu ul li.current-menu-ancestor > a, #back-to-top i.open, #back-to-top i:hover, .post-article .link a:hover, .post-article .quote:hover, .filter li:hover, .filter li.active, ul.widget-category li a:hover, #wp-calendar #today, #wp-calendar #today a, .tagcloud a:hover, .tabs li a:hover, .tabs li.ui-tabs-active a, .tabs li.ui-state-active a, .toggle_container h5.element:hover, .toggle_container h5.inactive, .toggle_container h5.inactive:hover, .socials a:hover, .wp-pagenavi a:hover, .wp-pagenavi span.current, .wip-pagination span, .wip-pagination span:hover, #searchform input[type=submit]:hover, .contact-form input[type=submit]:hover, #commentform input[type=submit]:hover, .skills .views.active, .skills .views:hover, .theme-default .nivo-directionNav a:hover, .flexslider:hover .flex-next:hover, .flexslider:hover .flex-prev:hover, nav#widgetmenu li a:hover, nav#widgetmenu li:hover > a , nav#widgetmenu li.current-menu-item > a, nav#widgetmenu li.current-menu-ancestor > a { background-color: #1abc9c; } a.more:hover, a:hover, #footer a:hover, #sidebar a:hover, .post-article .title a:hover, .post-info a:hover, .filterable-grid  h4.title a:hover, .filterable-grid  h4.title a:focus, #logo a:hover, #footer a:hover { color: #1abc9c; } nav#mainmenu ul li a:hover,nav#mainmenu li:hover > a,nav#mainmenu ul li.current-menu-item > a, nav#mainmenu ul li.current_page_item > a, nav#mainmenu ul li.current-menu-parent > a, nav#mainmenu ul li.current_page_ancestor > a, nav#mainmenu ul li.current-menu-ancestor > a, nav#mainmenu ul ul li:last-of-type a:hover, nav#mainmenu ul ul li:last-of-type:hover > a, nav#mainmenu ul ul li.current-menu-item > a, nav#mainmenu ul ul li.current_page_item > a, nav#mainmenu ul ul li.current-menu-parent > a, nav#mainmenu ul ul li.current_page_ancestor > a, nav#mainmenu ul ul li.current-menu-ancestor > a, #back-to-top i.open, #back-to-top i:hover, ul.widget-category li a:hover, .tagcloud a:hover, .toggle_container h5.element:hover, .toggle_container h5.inactive, .toggle_container h5.inactive:hover, .toggle_container h5.element:hover:last-of-type, .toggle_container h5.inactive:last-of-type, .toggle_container h5.inactive:hover:last-of-type, .socials a:hover, #searchform input[type=submit]:hover, .contact-form input[type=submit]:hover, #commentform input[type=submit]:hover, nav#widgetmenu li a:hover, nav#widgetmenu li:hover > a , nav#widgetmenu li.current-menu-item > a, nav#widgetmenu li.current-menu-ancestor > a { border-color: #1abc9c; } </style>
</head>

<body class="single single-post postid-12 single-format-standard custom-background custombody" >

<header id="header">

    <div class="container">
    
        <div class="row">
        
        	<div class="col-md-12">
            
            	<div id="logo">
                
                    <a href="http://www.pabloleanomartinet.com" title="Pablo Leano Martinet">
                            
                        Pablo Leano Martinet                                
                    </a>
                
                </div>
				
                <nav id="mainmenu" >
               
                	<ul id="menu-menu-1" class="menu"><li id="menu-item-70" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-70"><a href="http://www.pabloleanomartinet.com/">Home Page</a></li>
<li id="menu-item-72" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-72"><a href="http://www.pabloleanomartinet.com/category/posts/">Posts</a></li>
<li id="menu-item-73" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-73"><a href="http://www.pabloleanomartinet.com/category/project/">Projects</a></li>
<li id="menu-item-79" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-79"><a href="http://www.pabloleanomartinet.com/about-me/">About Me</a></li>
</ul>                
                </nav> 
				
                <div class="clear"></div>
            
            </div>
            
        </div>
        
    </div>
    
</header>
<div class="container">
	
    <div class="row">
       
        <div class="col-md-12 full">
        	
            <div class="row">
        
                <article class="post-12 post type-post status-publish format-standard hentry category-posts tag-cakephp-2-x tag-habtm tag-save tag-validation post-container col-md-12" >
                    
                    			
            <div class="post-article post-title">	
                <h1 class="title icon-title"> 
                	Cakephp 2.x Saving and validating a HABTM relation example                	<span><i class="fa fa-pencil-square-o"></i></span>
                </h1>
			</div>
            
		    
<div class="post-article">

	
    	<div class="line"> <span> On January 24, 2014 by pablo </span> </div>

	<p>Even if the documentation on this subject is quite complete, I will write an example of how to do it including a control witch validates the number of elements saved.</p>
<p>First I’ll give you only the code and after that (for those who are interested) I’ll give some notes about it. Or you could <a title="cakephp habtm repository" href="https://github.com/pleasedontbelong/cakephp2.2-habtm-example" target="_blank">download/pull the github repository</a> to test it. I&#8217;ve also added some unit test that I&#8217;ll use for new versions of cakephp. Please do clone this code and feel free to fork, repair, etc.</p>
<h2>The database model</h2>
<p><img class="size-full wp-image-237" title="cakephp habtm model example" src="http://www.pabloleanomartinet.com/wp-content/uploads/2012/10/model.png" alt="post habtm tags" width="561" height="148" /></p>
<p><em>Read the <a href="http://book.cakephp.org/2.0/en/getting-started/cakephp-conventions.html#model-and-database-conventions">naming conventions</a></em></p>
<h2>The Model</h2>
<h3>Post.php</h3>
<div style="font-size: 12px; line-height: 1.3em;"><div class="wrap_githubgist" style="width:100%"><script src = "http://gist-it.sudarmuthu.com/github/pleasedontbelong/cakephp2.2-habtm-example/blob/master/app/Model/Post.php?footer=minimal"></script></div></div>
<h3>Tag.php</h3>
<div style="font-size: 12px; line-height: 1.3em;"><div class="wrap_githubgist" style="width:100%"><script src = "http://gist-it.sudarmuthu.com/github/pleasedontbelong/cakephp2.2-habtm-example/blob/master/app/Model/Tag.php?footer=minimal"></script></div></div>
<h3>PostController.php</h3>
<div style="font-size: 12px; line-height: 1.3em;"><div class="wrap_githubgist" style="width:100%"><script src = "http://gist-it.sudarmuthu.com/github/pleasedontbelong/cakephp2.2-habtm-example/blob/master/app/Controller/PostsController.php?slice=39:53&footer=minimal"></script></div></div>
<h3>Post/add.ctp</h3>
<div style="font-size: 12px; line-height: 1.3em;"><div class="wrap_githubgist" style="width:100%"><script src = "http://gist-it.sudarmuthu.com/github/pleasedontbelong/cakephp2.2-habtm-example/blob/master/app/View/Posts/add.ctp?footer=minimal"></script></div></div>
<h2>Where’s the magic?</h2>
<p>If you look closely, you’ll find that almost everything is in the Model. The add() method on the Controller is just a simple (baked) method used to save the Post model and its associated Tags.</p>
<p>Basically to save a HABTM relation you need the data to be structured like this:</p>
<div style="font-size: 12px; line-height: 1.3em;"><div class="wrap_githubgist" style="width:100%"><script>document.write('<link rel="stylesheet" href="https://gist-assets.github.com/assets/embed-8bf0013c72fb64f0bb1bc1872b43e39e.css">')
document.write('<div id=\"gist8647994\" class=\"gist\">\n        <div class=\"gist-file\">\n          <div class=\"gist-data gist-syntax\">\n            \n\n\n\n    <div class=\"file-data\">\n      <table cellpadding=\"0\" cellspacing=\"0\" class=\"lines highlight\">\n        <tr>\n          <td class=\"line-numbers\">\n            <span class=\"line-number\" id=\"file-habtm_structure-L1\" rel=\"file-habtm_structure-L1\">1<\/span>\n            <span class=\"line-number\" id=\"file-habtm_structure-L2\" rel=\"file-habtm_structure-L2\">2<\/span>\n            <span class=\"line-number\" id=\"file-habtm_structure-L3\" rel=\"file-habtm_structure-L3\">3<\/span>\n            <span class=\"line-number\" id=\"file-habtm_structure-L4\" rel=\"file-habtm_structure-L4\">4<\/span>\n            <span class=\"line-number\" id=\"file-habtm_structure-L5\" rel=\"file-habtm_structure-L5\">5<\/span>\n            <span class=\"line-number\" id=\"file-habtm_structure-L6\" rel=\"file-habtm_structure-L6\">6<\/span>\n            <span class=\"line-number\" id=\"file-habtm_structure-L7\" rel=\"file-habtm_structure-L7\">7<\/span>\n            <span class=\"line-number\" id=\"file-habtm_structure-L8\" rel=\"file-habtm_structure-L8\">8<\/span>\n            <span class=\"line-number\" id=\"file-habtm_structure-L9\" rel=\"file-habtm_structure-L9\">9<\/span>\n            <span class=\"line-number\" id=\"file-habtm_structure-L10\" rel=\"file-habtm_structure-L10\">10<\/span>\n            <span class=\"line-number\" id=\"file-habtm_structure-L11\" rel=\"file-habtm_structure-L11\">11<\/span>\n            <span class=\"line-number\" id=\"file-habtm_structure-L12\" rel=\"file-habtm_structure-L12\">12<\/span>\n            <span class=\"line-number\" id=\"file-habtm_structure-L13\" rel=\"file-habtm_structure-L13\">13<\/span>\n            <span class=\"line-number\" id=\"file-habtm_structure-L14\" rel=\"file-habtm_structure-L14\">14<\/span>\n            <span class=\"line-number\" id=\"file-habtm_structure-L15\" rel=\"file-habtm_structure-L15\">15<\/span>\n          <\/td>\n          <td class=\"line-data\">\n            <pre class=\"line-pre\"><div class=\"line\" id=\"file-habtm_structure-LC1\">Array\n<\/div><div class=\"line\" id=\"file-habtm_structure-LC2\">	(\n<\/div><div class=\"line\" id=\"file-habtm_structure-LC3\">	[Post] =&gt; Array\n<\/div><div class=\"line\" id=\"file-habtm_structure-LC4\">		(\n<\/div><div class=\"line\" id=\"file-habtm_structure-LC5\">			[name] =&gt; my test post\n<\/div><div class=\"line\" id=\"file-habtm_structure-LC6\">		)\n<\/div><div class=\"line\" id=\"file-habtm_structure-LC7\">	[Tag] =&gt; Array\n<\/div><div class=\"line\" id=\"file-habtm_structure-LC8\">		(\n<\/div><div class=\"line\" id=\"file-habtm_structure-LC9\">		[Tag] =&gt; Array\n<\/div><div class=\"line\" id=\"file-habtm_structure-LC10\">			(\n<\/div><div class=\"line\" id=\"file-habtm_structure-LC11\">				[0] =&gt; 1\n<\/div><div class=\"line\" id=\"file-habtm_structure-LC12\">				[1] =&gt; 3\n<\/div><div class=\"line\" id=\"file-habtm_structure-LC13\">			)\n<\/div><div class=\"line\" id=\"file-habtm_structure-LC14\">		)\n<\/div><div class=\"line\" id=\"file-habtm_structure-LC15\">	)\n<\/div><\/pre>\n          <\/td>\n        <\/tr>\n      <\/table>\n    <\/div>\n\n          <\/div>\n          <div class=\"gist-meta\">\n            <a href=\"https://gist.github.com/pleasedontbelong/8647994/raw/habtm_structure\" style=\"float:right\">view raw<\/a>\n            <a href=\"https://gist.github.com/pleasedontbelong/8647994#file-habtm_structure\">habtm_structure<\/a>\n            hosted with &#10084; by <a href=\"https://github.com\">GitHub<\/a>\n          <\/div>\n        <\/div>\n<\/div>\n')
</script><div style='margin-bottom:1em;padding:0;'><noscript><code><pre style='overflow:auto;margin:0;padding:0;border:1px solid #DDD;'>&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta http-equiv=&quot;Content-type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;
    &lt;title&gt;Server Error &amp;middot; Gist&lt;/title&gt;
    &lt;style type=&quot;text/css&quot; media=&quot;screen&quot;&gt;
      body {
        background: #f1f1f1;
        font-family: &quot;HelveticaNeue-Light&quot;, Helvetica, Arial, sans-serif;
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased; }

      .container { margin: 100px auto; width: 600px; text-align: center; }

      a { color: #4183c4; text-decoration: none; }
      a:visited { color: #4183c4 }
      a:hover { text-decoration: none; }

      h1 { letter-spacing: -1px; line-height: 60px; font-size: 60px; font-weight: 100; margin: 0px; text-shadow: 0 1px 0 #fff; }
      p { color: rgba(0, 0, 0, 0.5); margin: 20px 0 40px; }

      ul { border-top: 1px solid #ccc; list-style: none; margin: 20px 0; padding: 20px 0; }
      li { display: table-cell; font-weight: bold; width: 1%; }
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div class=&quot;container&quot;&gt;
      &lt;h1&gt;OH NOES, 404.&lt;/h1&gt;
      &lt;p&gt;We seem to have missed the &lt;em&gt;gist&lt;/em&gt; of that &lt;em&gt;gist&lt;/em&gt; you were looking for.&lt;/p&gt;
      &lt;ul id=&quot;error-suggestions&quot;&gt;
          &lt;li&gt;&lt;a href=&quot;https://github.com/contact&quot;&gt;Contact Support&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;https://status.github.com&quot;&gt;Status Site&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;https://twitter.com/github&quot;&gt;@github&lt;/a&gt;&lt;/li&gt;
      &lt;/ul&gt;
      &lt;p&gt;&lt;img src=&quot;https://github.s3.amazonaws.com/media/maint-logo.png&quot; alt=&quot;GitHub&quot;&gt;&lt;/p&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre></code></noscript></div></div></div>
<p><em>(Why does the Tag array needs to be formatted like that??? I really have no idea.)</em></p>
<p>If you want to validate the number of tags that can be added to a post, you could use the “<a href="http://book.cakephp.org/2.0/en/models/data-validation.html#Validation::multiple">multiple validator</a>”. But in order to be able to use the multiple validator, the data must be structured like this:</p>
<div style="font-size: 12px; line-height: 1.3em;"><div class="wrap_githubgist" style="width:100%"><script>document.write('<link rel="stylesheet" href="https://gist-assets.github.com/assets/embed-8bf0013c72fb64f0bb1bc1872b43e39e.css">')
document.write('<div id=\"gist8647994\" class=\"gist\">\n        <div class=\"gist-file\">\n          <div class=\"gist-data gist-syntax\">\n            \n\n\n\n    <div class=\"file-data\">\n      <table cellpadding=\"0\" cellspacing=\"0\" class=\"lines highlight\">\n        <tr>\n          <td class=\"line-numbers\">\n            <span class=\"line-number\" id=\"file-validator_structure-L1\" rel=\"file-validator_structure-L1\">1<\/span>\n            <span class=\"line-number\" id=\"file-validator_structure-L2\" rel=\"file-validator_structure-L2\">2<\/span>\n            <span class=\"line-number\" id=\"file-validator_structure-L3\" rel=\"file-validator_structure-L3\">3<\/span>\n            <span class=\"line-number\" id=\"file-validator_structure-L4\" rel=\"file-validator_structure-L4\">4<\/span>\n            <span class=\"line-number\" id=\"file-validator_structure-L5\" rel=\"file-validator_structure-L5\">5<\/span>\n            <span class=\"line-number\" id=\"file-validator_structure-L6\" rel=\"file-validator_structure-L6\">6<\/span>\n            <span class=\"line-number\" id=\"file-validator_structure-L7\" rel=\"file-validator_structure-L7\">7<\/span>\n            <span class=\"line-number\" id=\"file-validator_structure-L8\" rel=\"file-validator_structure-L8\">8<\/span>\n            <span class=\"line-number\" id=\"file-validator_structure-L9\" rel=\"file-validator_structure-L9\">9<\/span>\n            <span class=\"line-number\" id=\"file-validator_structure-L10\" rel=\"file-validator_structure-L10\">10<\/span>\n            <span class=\"line-number\" id=\"file-validator_structure-L11\" rel=\"file-validator_structure-L11\">11<\/span>\n            <span class=\"line-number\" id=\"file-validator_structure-L12\" rel=\"file-validator_structure-L12\">12<\/span>\n          <\/td>\n          <td class=\"line-data\">\n            <pre class=\"line-pre\"><div class=\"line\" id=\"file-validator_structure-LC1\">Array\n<\/div><div class=\"line\" id=\"file-validator_structure-LC2\">	(\n<\/div><div class=\"line\" id=\"file-validator_structure-LC3\">	[Post] =&gt; Array\n<\/div><div class=\"line\" id=\"file-validator_structure-LC4\">		(\n<\/div><div class=\"line\" id=\"file-validator_structure-LC5\">			[name] =&gt; my other test post\n<\/div><div class=\"line\" id=\"file-validator_structure-LC6\">			[Tag] =&gt; Array\n<\/div><div class=\"line\" id=\"file-validator_structure-LC7\">				(\n<\/div><div class=\"line\" id=\"file-validator_structure-LC8\">				[0] =&gt; 2\n<\/div><div class=\"line\" id=\"file-validator_structure-LC9\">				[1] =&gt; 4\n<\/div><div class=\"line\" id=\"file-validator_structure-LC10\">			)\n<\/div><div class=\"line\" id=\"file-validator_structure-LC11\">		)\n<\/div><div class=\"line\" id=\"file-validator_structure-LC12\">	)\n<\/div><\/pre>\n          <\/td>\n        <\/tr>\n      <\/table>\n    <\/div>\n\n          <\/div>\n          <div class=\"gist-meta\">\n            <a href=\"https://gist.github.com/pleasedontbelong/8647994/raw/validator_structure\" style=\"float:right\">view raw<\/a>\n            <a href=\"https://gist.github.com/pleasedontbelong/8647994#file-validator_structure\">validator_structure<\/a>\n            hosted with &#10084; by <a href=\"https://github.com\">GitHub<\/a>\n          <\/div>\n        <\/div>\n<\/div>\n')
</script><div style='margin-bottom:1em;padding:0;'><noscript><code><pre style='overflow:auto;margin:0;padding:0;border:1px solid #DDD;'>&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta http-equiv=&quot;Content-type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;
    &lt;title&gt;Server Error &amp;middot; Gist&lt;/title&gt;
    &lt;style type=&quot;text/css&quot; media=&quot;screen&quot;&gt;
      body {
        background: #f1f1f1;
        font-family: &quot;HelveticaNeue-Light&quot;, Helvetica, Arial, sans-serif;
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased; }

      .container { margin: 100px auto; width: 600px; text-align: center; }

      a { color: #4183c4; text-decoration: none; }
      a:visited { color: #4183c4 }
      a:hover { text-decoration: none; }

      h1 { letter-spacing: -1px; line-height: 60px; font-size: 60px; font-weight: 100; margin: 0px; text-shadow: 0 1px 0 #fff; }
      p { color: rgba(0, 0, 0, 0.5); margin: 20px 0 40px; }

      ul { border-top: 1px solid #ccc; list-style: none; margin: 20px 0; padding: 20px 0; }
      li { display: table-cell; font-weight: bold; width: 1%; }
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div class=&quot;container&quot;&gt;
      &lt;h1&gt;OH NOES, 404.&lt;/h1&gt;
      &lt;p&gt;We seem to have missed the &lt;em&gt;gist&lt;/em&gt; of that &lt;em&gt;gist&lt;/em&gt; you were looking for.&lt;/p&gt;
      &lt;ul id=&quot;error-suggestions&quot;&gt;
          &lt;li&gt;&lt;a href=&quot;https://github.com/contact&quot;&gt;Contact Support&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;https://status.github.com&quot;&gt;Status Site&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;https://twitter.com/github&quot;&gt;@github&lt;/a&gt;&lt;/li&gt;
      &lt;/ul&gt;
      &lt;p&gt;&lt;img src=&quot;https://github.s3.amazonaws.com/media/maint-logo.png&quot; alt=&quot;GitHub&quot;&gt;&lt;/p&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre></code></noscript></div></div></div>
<p><em>(Again: Why does the Tag array needs to be formatted like that??? I really have no idea.)</em></p>
<p>As you can see, the HABTM relationship needs the data in a different way that the validator, clearly it is a contradiction between the validation and the data saving. The validator needs the Tag array inside the Post, and the save method needs the Tags at the same level of the Post. Surely you could transform the data inside the controller, but where’s the fun in that? Let’s better use the <strong>before save</strong> callback, because maybe you have multiple HABTM relations and you want to preserve a skinny controller and a fat model. In this case I used the <strong>before save</strong> on the Post Model, but you could also define it in the AppModel so it will work for all models.</p>
<p>And that&#8217;s it!. Now if you try to save the Post without choosing any tag, you should see something like this:</p>
<p><img class="aligncenter size-large wp-image-242" title="validation on habtm" src="http://www.pabloleanomartinet.com/wp-content/uploads/2012/10/screen-1024x421.png" alt="Example data validation on HABTM relation" width="584" height="240" /></p>
<p>This might not be the cleanest way, but I couldn&#8217;t find a better way to do it (without using js validation of course). And the documentation doesn&#8217;t say anything about this, so&#8230;.</p>
<p>Hope this helps!</p>
<p><strong>Hey! if you want to give it a try. I have created a repository so you could pull, test, correct, improve this code. Just go to the <a title="cakephp habtm repository" href="https://github.com/pleasedontbelong/cakephp2.2-habtm-example" target="_blank">repository on github.<br />
</a></strong></p>
<div class="addtoany_share_save_container addtoany_content_bottom"><div class="a2a_kit a2a_kit_size_32 addtoany_list a2a_target" id="wpa2a_1"><a class="a2a_button_facebook" href="http://www.addtoany.com/add_to/facebook?linkurl=http%3A%2F%2Fwww.pabloleanomartinet.com%2Fcakephp-2-x-saving-validating-habtm-relation-example%2F&amp;linkname=Cakephp%202.x%20Saving%20and%20validating%20a%20HABTM%20relation%20example" title="Facebook" rel="nofollow" target="_blank"></a><a class="a2a_button_twitter" href="http://www.addtoany.com/add_to/twitter?linkurl=http%3A%2F%2Fwww.pabloleanomartinet.com%2Fcakephp-2-x-saving-validating-habtm-relation-example%2F&amp;linkname=Cakephp%202.x%20Saving%20and%20validating%20a%20HABTM%20relation%20example" title="Twitter" rel="nofollow" target="_blank"></a><a class="a2a_button_google_plus" href="http://www.addtoany.com/add_to/google_plus?linkurl=http%3A%2F%2Fwww.pabloleanomartinet.com%2Fcakephp-2-x-saving-validating-habtm-relation-example%2F&amp;linkname=Cakephp%202.x%20Saving%20and%20validating%20a%20HABTM%20relation%20example" title="Google+" rel="nofollow" target="_blank"></a><a class="a2a_dd addtoany_share_save" href="https://www.addtoany.com/share_save"></a>
<script type="text/javascript"><!--
wpa2a.script_load();
//--></script>
</div></div><div class="clear"></div>        <div class="post-info">
            <div class="left"> <a href="http://www.pabloleanomartinet.com/category/posts/" rel="category tag">Posts</a> </div>
            <div class="right"> Tags: <a href="http://www.pabloleanomartinet.com/tag/cakephp-2-x/" rel="tag">cakephp 2.x</a>, <a href="http://www.pabloleanomartinet.com/tag/habtm/" rel="tag">habtm</a>, <a href="http://www.pabloleanomartinet.com/tag/save/" rel="tag">save</a>, <a href="http://www.pabloleanomartinet.com/tag/validation/" rel="tag">validation</a>  </div>
        </div>
            
        <div class="clear"></div>

    

</div>                        
                    <div style="clear:both"></div>
                    
                </article>
        
                
<div id="disqus_thread">
            <div id="dsq-content">


            <ul id="dsq-comments">
                    <li class="comment even thread-even depth-1" id="dsq-comment-888">
        <div id="dsq-comment-header-888" class="dsq-comment-header">
            <cite id="dsq-cite-888">
                <span id="dsq-author-user-888">Said Bakr</span>
            </cite>
        </div>
        <div id="dsq-comment-body-888" class="dsq-comment-body">
            <div id="dsq-comment-message-888" class="dsq-comment-message"><p>Could you able to discuss in new article the dealing with haveMany through. i.e in your example database we just able to deal with an extra data field in posts_tags table such as `order` which is an integer used to make an order value for the tags listed per each post. For example, suppose that blogs contains just three tags, politics, sports, science. So we have a political post that may talk about science but we want to be sure that tags will be in the following order: politics, science, so we will use the order field.</p>
<p>We need to know how to make add or edit view that is going to be able to list all tags and next to each tag the value of the order could be inserted.</p>
</div>
        </div>

    <ul class="children">
    <li class="comment byuser comment-author-pablo bypostauthor odd alt depth-2" id="dsq-comment-3852">
        <div id="dsq-comment-header-3852" class="dsq-comment-header">
            <cite id="dsq-cite-3852">
                <span id="dsq-author-user-3852">pablo</span>
            </cite>
        </div>
        <div id="dsq-comment-body-3852" class="dsq-comment-body">
            <div id="dsq-comment-message-3852" class="dsq-comment-message"><p>I&#8217;ll try to do write about it later <img src="http://www.pabloleanomartinet.com/wp-includes/images/smilies/icon_razz.gif" alt=":P" class="wp-smiley" /> but for now i&#8217;m into python and JS&#8230; but it seems that HABTM relations with extra fields could give me more visits so I&#8217;ll try to write about it <img src="http://www.pabloleanomartinet.com/wp-includes/images/smilies/icon_razz.gif" alt=":P" class="wp-smiley" /></p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-3851">
        <div id="dsq-comment-header-3851" class="dsq-comment-header">
            <cite id="dsq-cite-3851">
                <span id="dsq-author-user-3851">Laura</span>
            </cite>
        </div>
        <div id="dsq-comment-body-3851" class="dsq-comment-body">
            <div id="dsq-comment-message-3851" class="dsq-comment-message"><p>Hi,<br />
what if there is a dropdown with one selection, instead of multiple selection?<br />
What will be the code in the view? I &#8216;ve found a lot of examples but none of them are correct..</p>
<p>Thank you<br />
Laura</p>
</div>
        </div>

    <ul class="children">
    <li class="comment byuser comment-author-pablo bypostauthor odd alt depth-2" id="dsq-comment-3853">
        <div id="dsq-comment-header-3853" class="dsq-comment-header">
            <cite id="dsq-cite-3853">
                <span id="dsq-author-user-3853">pablo</span>
            </cite>
        </div>
        <div id="dsq-comment-body-3853" class="dsq-comment-body">
            <div id="dsq-comment-message-3853" class="dsq-comment-message"><p>Hi Laura,</p>
<p>If you have a dropdown (only one possible value selected) then probably the relation is not a HABTM but a simple HasMany relation.</p>
<p>If you use a HasMany relationship, you could simply `bake` a view and it will add the dropdown and all</p>
<p>Hope this helps</p>
</div>
        </div>

    <ul class="children">
    <li class="comment even depth-3" id="dsq-comment-3855">
        <div id="dsq-comment-header-3855" class="dsq-comment-header">
            <cite id="dsq-cite-3855">
                <span id="dsq-author-user-3855">Laura</span>
            </cite>
        </div>
        <div id="dsq-comment-body-3855" class="dsq-comment-body">
            <div id="dsq-comment-message-3855" class="dsq-comment-message"><p>Thank you for your quick reply, I appreciate it.<br />
I have habtn relationship become a user could belong to one or many groups, and viceverse a group could be made by one or many users.<br />
So the relation is not one to many, right?<br />
In my case, one user has just one group associated (If a use one multiple selection with just one group selected, or a single selection with one group selected, isn&#8217;it the same thing?</p>
<p>Thanks again for the help.</p>
</div>
        </div>

    <ul class="children">
    <li class="comment byuser comment-author-pablo bypostauthor odd alt depth-4" id="dsq-comment-3856">
        <div id="dsq-comment-header-3856" class="dsq-comment-header">
            <cite id="dsq-cite-3856">
                <span id="dsq-author-user-3856">pablo</span>
            </cite>
        </div>
        <div id="dsq-comment-body-3856" class="dsq-comment-body">
            <div id="dsq-comment-message-3856" class="dsq-comment-message"><p>Ahh ok, so yes, in that case <b>it is a HABTM relation</b>. If I understood correctly, you have a HABTM but in your form you want to limit to only one single Group. So yes you can use a dropdown to do it, you&#8217;ll probablly need to modify a little bit the `$this->request->data` before calling the `User->save()` method on your controller.</p>
<p>In the end, you&#8217;ll nedd to call $this->User->save($data) where $data is something like:</p>
<pre>
Array
	(
	[User] => Array
		(
			[name] => just an example
			....
		)
	[Group] => Array
		(
		[Group] => Array
			(
				[0] => 123  // your group id sent by the form
			)
		)
	)
	
</pre>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment even depth-2" id="dsq-comment-3854">
        <div id="dsq-comment-header-3854" class="dsq-comment-header">
            <cite id="dsq-cite-3854">
                <span id="dsq-author-user-3854">Laura</span>
            </cite>
        </div>
        <div id="dsq-comment-body-3854" class="dsq-comment-body">
            <div id="dsq-comment-message-3854" class="dsq-comment-message"><p>I have the same model (instead of Post I have Users and instead of Tags i have Groups, and a dropdown list (witha single selection).<br />
I insert User info correctly in the table of users but when I select inside the dropdown list the group name (related to the user ) nothing is saved in the join table groups_users.<br />
What am i doing wrong?<br />
Please can you help me?<br />
Thank you</p>
<p>LAura</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment odd alt thread-even depth-1" id="dsq-comment-22565">
        <div id="dsq-comment-header-22565" class="dsq-comment-header">
            <cite id="dsq-cite-22565">
                <span id="dsq-author-user-22565">Giovanny de arco</span>
            </cite>
        </div>
        <div id="dsq-comment-body-22565" class="dsq-comment-body">
            <div id="dsq-comment-message-22565" class="dsq-comment-message"><p>thanks!!</p>
</div>
        </div>

    </li><!-- #comment-## -->
            </ul>


        </div>

    </div>


			</div>
        
        </div>

		
        <div class="clear"></div>

           
    </div>
    
</div>

<div id="back-to-top"> <i class="fa fa-chevron-up"></i> </div>

<footer id="footer">
	
    <div class="container">

		        
			<section class="row widgets">
                    
				<div class="col-md-4 widget-box"><h4 class="title">Categories</h4>		<ul>
	<li class="cat-item cat-item-2"><a href="http://www.pabloleanomartinet.com/category/posts/" >Posts</a> (8)
</li>
	<li class="cat-item cat-item-15"><a href="http://www.pabloleanomartinet.com/category/project/" >Project</a> (2)
</li>
		</ul>
</div>                    
            </section>
                
        
        <div class="row" >
             
			<div class="col-md-12" >

                <div class="copyright">

                    <p>
                                                  Copyright Pablo Leano Martinet 2015 
                         
                        | Theme by <a href="http://www.themeinprogress.com/" target="_blank">Theme in Progress</a> |
                        <a href="http://wordpress.org/" title="A Semantic Personal Publishing Platform" rel="generator">Proudly powered by WordPress</a>
                    
                    </p>

				</div>
                
                
                <div class="clear"></div>
                
			</div>
                
		</div>
        
	</div>
    
</footer>


<script type="text/javascript"><!--
wpa2a.targets=[
{title:'Cakephp 2.x Saving and validating a HABTM relation example',url:'http://www.pabloleanomartinet.com/cakephp-2-x-saving-validating-habtm-relation-example/'}];
wpa2a.html_done=true;if(wpa2a.script_ready&&!wpa2a.done)wpa2a.init();wpa2a.script_load();
//--></script>
<!-- Tracking code easily added by NK Google Analytics -->
<script type="text/javascript"> 
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ 
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), 
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) 
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); 
ga('create', 'UA-12714966-2', 'pabloleanomartinet.com'); 
ga('send', 'pageview'); 
</script> 
<script type='text/javascript' src='http://www.pabloleanomartinet.com/wp-includes/js/comment-reply.min.js?ver=4.0.1'></script>
<script type='text/javascript' src='http://www.pabloleanomartinet.com/wp-includes/js/jquery/ui/jquery.ui.core.min.js?ver=1.10.4'></script>
<script type='text/javascript' src='http://www.pabloleanomartinet.com/wp-includes/js/jquery/ui/jquery.ui.widget.min.js?ver=1.10.4'></script>
<script type='text/javascript' src='http://www.pabloleanomartinet.com/wp-includes/js/jquery/ui/jquery.ui.tabs.min.js?ver=1.10.4'></script>
<script type='text/javascript' src='http://www.pabloleanomartinet.com/wp-content/themes/diarjo-lite/js/jquery.easing.1.3.js?ver=4.0.1'></script>
<script type='text/javascript' src='http://www.pabloleanomartinet.com/wp-content/themes/diarjo-lite/js/jquery.prettyPhoto.js?ver=4.0.1'></script>
<script type='text/javascript' src='http://www.pabloleanomartinet.com/wp-content/themes/diarjo-lite/js/jquery.scrollTo.js?ver=4.0.1'></script>
<script type='text/javascript' src='http://www.pabloleanomartinet.com/wp-content/themes/diarjo-lite/js/jquery.tinynav.js?ver=4.0.1'></script>
<script type='text/javascript' src='http://www.pabloleanomartinet.com/wp-content/themes/diarjo-lite/js/jquery.wip.js?ver=4.0.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var embedVars = {"disqusConfig":{"platform":"wordpress@4.0.1","language":""},"disqusIdentifier":"12 http:\/\/www.pabloleanomartinet.com\/?p=12","disqusShortname":"pleasedontbelong","disqusTitle":"Cakephp 2.x Saving and validating a HABTM relation example","disqusUrl":"http:\/\/www.pabloleanomartinet.com\/cakephp-2-x-saving-validating-habtm-relation-example\/","options":{"manualSync":false},"postId":"12"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.pabloleanomartinet.com/wp-content/plugins/disqus-comment-system/media/js/disqus.js?ver=4.0.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"pleasedontbelong"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.pabloleanomartinet.com/wp-content/plugins/disqus-comment-system/media/js/count.js?ver=4.0.1'></script>
  
 
</body>

</html>